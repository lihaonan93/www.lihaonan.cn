---
title: 同步MySQL表结构和数据
date: 2023-03-24 13:17:11
permalink: /pages/461816/
categories:
  - Linux
  - Shell脚本
tags:
  - 
---

```bash
#!/bin/bash

# 要操作的数据表写入此文件
sql_file=/data/sql_file.txt

#导出数据表存放路径
sql_dump=/data/sql_dump

# db1数据库信息
db1_ip='数据库地址'
db1_user=数据库用户名
db1_password=数据库密码

# db2数据库信息
db2_ip='数据库地址'
db2_user=数据库用户名
db2_password=数据库密码

# db23数据库信息
db3_ip='数据库地址'
db3_user=数据库用户名
db3_password=数据库密码

# 选择导出导入数据库
read -rp "请输入导出数据库： db1 | db2 | db3 （输入q退出脚本）" EXPORT
read -rp "请输入导入数据库： db1 | db2 | db3 （输入q退出脚本）" IMPORT

#定义导出数据表函数
export_sql(){
    while IFS= read -r line ; do
        mysqldump -u"$1" -p"$2" --set-gtid-purged=OFF -h"$3" --databases "$4" --tables "${line}" > ${sql_dump}/"${line}".sql
        echo -e "\033[31m数据表：${line} 导出完成\033[0m"
    done < ${sql_file}
}

#定义导入数据表函数
import_sql(){
    while IFS= read -r line ; do
        mysql -u"$1" -p"$2" -h"$3" -D"$4"  < ${sql_dump}/"${line}".sql
        echo -e "\033[31m数据表：${line} 导入完成\033[0m"
    done < ${sql_file}
}

#导出数据表
while true
do
    case $EXPORT in
        db1)
            export_sql ${db1_user} ${db1_password} ${db1_ip} db1
            break
            ;;
        db2)
            export_sql ${db2_user} ${db2_password} ${db2_ip} db2
            break
            ;;
        db3)
            export_sql ${db3_user} ${db3_password} ${db3_ip} db3
            break
            ;;
        q)
            rm -rf ${sql_dump}/*.sql
            echo -e "\033[31m数据表清理完成，脚本退出\033[0m"
            exit
            ;;
        *)
            echo -e "\033[31m错误:请输入正确选项\033[0m"
            exit
    esac
done

#导入数据表
while true
do
    case $IMPORT in
        db1)
            import_sql ${db1_user} ${db1_password} ${db1_ip} db1
            break
            ;;
        db2)
            import_sql ${db2_user} ${db2_password} ${db2_ip} db2
            break
            ;;
        db3)
            import_sql ${db3_user} ${db3_password} ${db3_ip} db3
            break
            ;;
        q)
            rm -rf ${sql_dump}/*.sql
            echo -e "\033[31m数据表清理完成，脚本退出\033[0m"
            exit
            ;;
        *)
            echo -e "\033[31m错误:请输入正确选项\033[0m"
            exit
    esac
done

#清除无用数据表
rm -rf ${sql_dump}/*.sql

#呼出结束信息
echo -e  "\033[36m==============================\n=============完成=============\n==============================\033[0m"

```


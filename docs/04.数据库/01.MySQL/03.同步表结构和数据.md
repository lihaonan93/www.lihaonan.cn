---
title: 同步表结构和数据
date: 2023-04-22 22:00:35
permalink: /pages/fb610d/
categories:
  - 数据库
  - MySQL
tags:
  - 
---
```bash
#!/bin/bash

# 表名写入此文件
TABLES_FILE_PATH='./TABLES_FILE.txt'

#导出的数据表临时存放路径
TABLES_STORAGE_PATH='./TABLES_STORAGE_PATH'

# db1数据库信息
DB1_IP='数据库地址'
DB1_USER='数据库用户名'
DB1_PASSWORD='数据库用户密码'

# db2数据库信息
DB2_IP='数据库地址'
DB2_USER='数据库用户名'
DB2_PASSWORD='数据库用户密码'

# db23数据库信息
DB3_IP='数据库地址'
DB3_USER='数据库用户名'
DB3_PASSWORD='数据库用户密码'

#定义导出数据表函数
export_sql(){
    while IFS= read -r line ; do
        mysqldump -u"$1" -p"$2" -h"$3" --set-gtid-purged=OFF --column-statistics=0 "$4" "${line}" > ${TABLES_STORAGE_PATH}/"${line}".sql
        echo -e "\033[31m数据表：${line} 导出完成\033[0m"
    done < ${TABLES_FILE_PATH}
}

#定义导入数据表函数
import_sql(){
    while IFS= read -r line ; do
        mysql -u"$1" -p"$2" -h"$3" "$4"  < ${TABLES_STORAGE_PATH}/"${line}".sql
        echo -e "\033[31m数据表：${line} 导入完成\033[0m"
    done < ${TABLES_FILE_PATH}
}

# 选择导出导入数据库
read -rp "请输入导出数据库： db1 | db2 | db3 （输入q退出脚本）" EXPORT

if [ "${EXPORT}" = q ] ; then
    echo -e "\033[31m脚本退出\033[0m"
    exit
fi

read -rp "请输入导入数据库： db1 | db2 | db3 （输入q退出脚本）" IMPORT

if [ "${IMPORT}" = q ] ; then
    echo -e "\033[31m脚本退出\033[0m"
    exit
fi

#导出数据表
case ${EXPORT} in
    db1)
        export_sql ${DB1_USER} ${DB1_PASSWORD} ${DB1_IP} db1
        ;;
    db2)
        export_sql ${DB2_USER} ${DB2_PASSWORD} ${DB2_IP} db2
        ;;
    db3)
        export_sql ${DB3_USER} ${DB3_PASSWORD} ${DB3_IP} db3
        ;;
    *)
        echo -e "\033[31m错误:请输入正确选项\033[0m"
        exit
esac

#导入数据表
case ${IMPORT} in
    db1)
        import_sql ${DB1_USER} ${DB1_PASSWORD} ${DB1_IP} db1
        ;;
    db2)
        import_sql ${DB2_USER} ${DB2_PASSWORD} ${DB2_IP} db2
        ;;
    db3)
        import_sql ${DB3_USER} ${DB3_PASSWORD} ${DB3_IP} db3
        ;;
    *)
        echo -e "\033[31m错误:请输入正确选项\033[0m"
        exit
esac

#清除无用数据表
rm -rf ${TABLES_STORAGE_PATH}/*.sql

#呼出结束信息
echo -e  "\033[36m==============================\n=============完成=============\n==============================\033[0m"

```


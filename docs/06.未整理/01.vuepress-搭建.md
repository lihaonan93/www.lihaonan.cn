---
title: vuepress-搭建
date: 2023-03-18 04:20:22
permalink: /pages/0648f4/
categories:
  - 未整理
tags:
  - 
---
# 使用nodejs官方镜像在当前目录构建vuepress项目

> 注：需要安装`Docker`环境

- #### 创建`vuepress`项目目录

  `mkdir -p /data/vuepress`

- #### 利用`docker nodejs`镜像来初始化

  ```bash
  docker run -it --rm --name yarn-build  \
  -v /data/vuepress:/usr/src/app \
  -w /usr/src/app \
  node:16.19.1-alpine3.17 \
  yarn init
  ```

- #### 安装 VuePress

   ```bash
   docker run -it --rm --name yarn-build  \
   -v /data/vuepress:/usr/src/app \
   -w /usr/src/app \
   node:16.19.1-alpine3.17 \
   yarn add -D vuepress
   ```

- #### 创建第一个文档

   `mkdir docs && echo '# 我的第一个VuePress页面' > docs/README.md`

   > `README.md `就是你的主页

- #### 添加脚本到`package.json`

   ```bash
   {
     "scripts": {
       "docs:dev": "vuepress dev docs",
       "docs:build": "vuepress build docs"
     }
   }
   ```

- #### 生成静态页面
   `yarn docs:build`

---

##  最后再通过nginx进行简单配置就OK啦

- #### `nginx Dockerfile`内容

    ```bash
  FROM openanolis/anolisos:8.6
    
  MAINTAINER 8956033@qq.com
  
  RUN     dnf -y install wget perl gcc pcre pcre-devel openssl-devel gd gd-devel && \
          useradd -s /bin/false www && \
          mkdir -p /var/log/nginx && \
          chown www.www /var/log/nginx && \
          wget -O /tmp/openresty-1.21.4.1.tar.gz https://openresty.org/download/openresty-1.21.4.1.tar.gz && \
          tar xf /tmp/openresty-1.21.4.1.tar.gz -C /tmp && \
          cd /tmp/openresty-1.21.4.1 && \
          ./configure \
                  --user=www \
                  --group=www \
                  --conf-path=/etc/openresty/nginx.conf \
                  --with-http_v2_module \
                  --with-http_flv_module \
                  --with-http_image_filter_module \
                  --with-http_gzip_static_module \
                  --with-http_gunzip_module \
                  --with-http_mp4_module \
                  --with-http_image_filter_module \
                  --with-http_stub_status_module \
                  --with-http_realip_module && \
          gmake && \
          gmake install && \
          dnf clean all && \
          rm -rf /tmp/*
  
  WORKDIR /etc/openresty
  
  ENV PATH=$PATH:/usr/local/openresty/luajit/bin:/usr/local/openresty/nginx/sbin:/usr/local/openresty/bin
  
  EXPOSE 80 443
  
  CMD ["nginx","-g","daemon off;"]
  ```

- #### 构建`nginx`镜像

  `docker build -t openresty:1.21.4.1 . `

- #### `nginx.conf`配置文件

  ```bash
  user www www;
  
  worker_processes        auto;
  worker_cpu_affinity     auto;
  
  worker_rlimit_nofile    65535;
  
  events  {
          worker_connections      102400;
          }
          
  http    {
  
          include mime.types;
  
          default_type  application/octet-stream;
  
          log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                          '$status $body_bytes_sent "$http_referer" '
                          '"$http_user_agent" "$http_x_forwarded_for"';
  
          log_format json '{"data":"$Y-$m-$d $H:$minutes:$S",'
                          '"status":"$status",'
                          '"ip":"$remote_addr",'
                          '"request":"$request",'
                          '"request_time":$request_time,'
                          '"referer":"$http_referer",'
                          '"x_forwarded":"$http_x_forwarded_for",'
                          '"browser":"$http_user_agent"'
                          '}';
  
          client_max_body_size    10m;
  
          client_body_buffer_size 10K;
          client_header_buffer_size 4k;
  
          open_file_cache max=65535 inactive=60s;
          open_file_cache_valid 30s;
          open_file_cache_min_uses 3;
  
          keepalive_timeout       120;
  
          ssi             on;
          sendfile        on;
          send_timeout    60;
          tcp_nopush      on;
  
          gzip on;
          gzip_vary       on;
          gzip_static     on;
          gzip_buffers 4 32k;
          gzip_min_length 1k;
          gzip_comp_level  5;
          gzip_disable    "MSIE [1-6]\.";
          gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
  
          include /etc/openresty/conf.d/*.conf;
  
          }
  ```

  

- #### `www.lihaonan.cn.conf`配置文件

  ```bash
  server {
        listen       80;
        server_name  www.lihaonan.cn;

        root    '/dist';

        access_log  /var/log/nginx/www.access.log json;
        error_log   /var/log/nginx/www.error.log error;

        index index.html index.htm;
        if ($time_iso8601 ~ "^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})") {
                set $Y $1;
                set $m $2;
                set $d $3;
                set $H $4;
                set $minutes $5;
                set $S $6;
         }
  }
  ```

  

- #### 启动`nginx`容器

  ```bash
  docker run -d --name openresty -p 80:80 \
  -v /data/nginx/etc/nginx.conf:/etc/openresty/nginx.conf \
  -v /data/nginx/etc/conf.d:/etc/openresty/conf.d \
  -v /data/vuepress/docs/.vuepress/dist:/dist \
  -v /data/nginx/logs:/var/log/nginx \
  -e TZ=Asia/Shanghai \
  openresty:1.21.4.1
  ```
  
  

